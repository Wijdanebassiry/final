@model WebApplication6.Models.FicheProjet
@{
    ViewData["Title"] = "Détails de la Fiche Projet";
}
<style>
body {
    background-color: #fff;
    color: #000;
}
@@media print {
    .classic-view { display: none !important; }
    .print-table-view { display: block !important; }
}
@@media screen {
    .print-table-view { display: none; }
}
.print-table-view {
    width: 95%;
    margin: 0 auto;
    font-family: 'Segoe UI', Arial, sans-serif;
    color: #000;
    background: #fff;
    font-size: 1.05rem;
}
.print-table-view .fiche-header {
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin-bottom: 0;
    min-height: 50px;
}
.print-table-view .fiche-title {
    flex: 1;
    text-align: center;
    font-size: 2.2rem;
    font-weight: bold;
    letter-spacing: 1px;
    margin: 1.2rem 0 0.7rem 0;
}
.print-table-view .fiche-divider {
    border: none;
    border-top: 2.5px solid #222;
    margin: 0 0 1.2rem 0;
}
.print-table-view table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1.2rem;
    background: #fff;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
}
.print-table-view th, .print-table-view td {
    border: 1px solid #bbb;
    padding: 7px 12px;
    vertical-align: top;
}
.print-table-view th {
    background: #fff;
    color: #000;
    font-weight: 700;
    text-align: left;
    font-size: 1.07rem;
    border: 1px solid #000;
}
.print-table-view .section-title, .print-table-view tr > th[colspan] {
    background: #fff;
    color: #000;
    font-weight: 700;
    text-align: left;
    font-size: 1.09rem;
    letter-spacing: 0.5px;
    border: 1px solid #000;
}
.print-table-view .checkbox-cell {
    text-align: center;
    font-size: 1.1rem;
}
.print-table-view .big-cell {
    height: 2.2cm;
    background: #fff;
}
.print-table-view .footer-date {
    text-align: right;
    margin-top: 1.5rem;
    font-size: 1.02rem;
    color: #000;
}
</style>

<!-- Vue classique écran -->
<div class="classic-view" style="background-color: #fff; color: #000;">
    <!-- En-tête avec logo et titre -->
    <div class="print-header" style="display: flex; align-items: center; margin-bottom: 20px;">
        <img src="~/img/promamec-logo.png" alt="PROMAMEC" style="width: 80px; height: auto; margin-right: 20px;" />
        <div class="print-header-title" style="text-align: center; flex-grow: 1; font-size: 2rem; font-weight: bold;">FICHE PROJET</div>
    </div>
    <hr class="print-divider" style="border: 2px solid #333; margin-bottom: 30px;" />
    
    <div class="print-content">
        <div class="print-fields">
            <!-- Tableau Date (1 ligne, 2 colonnes) -->
            <table class="table table-bordered" style="width: 50%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 30%; background-color: #fff; color: #000;">Date</th>
                    <td style="width: 70%; color: #000;">@DateTime.Now.ToString("dd/MM/yyyy")</td>
                </tr>
            </table>

            <!-- Tableau N° Projet et N° Affaires (2 lignes, 4 colonnes) -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 25%; background-color: #fff; color: #000;">N° Projet / N° Marché</th>
                    <td style="width: 25%; color: #000;">@Model.NumeroProjet</td>
                    <th style="width: 25%; background-color: #fff; color: #000;">N° Affaire(s)</th>
                    <td style="width: 25%; color: #000;">@Model.NumeroAffaire</td>
                </tr>
                <tr>
                    <th style="background-color: #fff; color: #000;">Nom du Client/ Etablissement</th>
                    <td style="color: #000;">@Model.NomClient</td>
                    <th style="background-color: #fff; color: #000;">Nom & Téléphone du Contact</th>
                    <td style="color: #000;">@Model.TelephoneContact</td>
                </tr>
            </table>

            <!-- Tableau Contrat N° (1 ligne) -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 25%; background-color: #fff; color: #000;">Contrat N° / Bande de Commande</th>
                    <td style="width: 75%; color: #000;">@Model.ContratNumero</td>
                </tr>
            </table>

            <!-- Tableau autres champs (5 lignes, 2 colonnes) -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 25%; background-color: #fff; color: #000;">Adresse de livraison</th>
                    <td style="width: 75%; color: #000;">@Model.AdresseLivraison</td>
                </tr>
                <tr>
                    <th style="background-color: #fff; color: #000;">Modalités de paiement Client</th>
                    <td style="color: #000;">@Model.ModalitePaiement</td>
                </tr>
                <tr>
                    <th style="background-color: #fff; color: #000;">Dernier délai Livraison</th>
                    <td style="color: #000;">@(Model.DernierDelaiLivraison?.ToString("dd/MM/yyyy") ?? "")</td>
                </tr>
                <tr>
                    <th style="background-color: #fff; color: #000;">Dernier délai d'exécution</th>
                    <td style="color: #000;">@(Model.DernierDelaiExecution?.ToString("dd/MM/yyyy") ?? "")</td>
                </tr>
                <tr>
                    <th style="background-color: #fff; color: #000;">Durée de garantie</th>
                    <td style="color: #000;">@Model.DureeGarantie</td>
                </tr>
            </table>

            <!-- Tableau Détail Formation -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 25%; background-color: #fff; color: #000;">Détail Formation</th>
                    <td style="width: 75%; color: #000;">@Model.DetailFormation</td>
                </tr>
            </table>

            <!-- Tableau Dossier AMSSNUR et Contrat Maintenance -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="width: 25%; background-color: #fff; color: #000;">Dossier AMSSNUR requis</th>
                    <td style="width: 25%; color: #000;">
                        <input type="checkbox" @(Model.DossierAMSSNUR ? "checked" : "") disabled style="margin-right: 5px;" />
                        <span style="color: #000;">Oui</span>
                        <input type="checkbox" @(!Model.DossierAMSSNUR ? "checked" : "") disabled style="margin-right: 5px; margin-left: 15px;" />
                        <span style="color: #000;">Non</span>
                    </td>
                    <th style="width: 25%; background-color: #fff; color: #000;">Contrat de maintenance à l'acquisition</th>
                    <td style="width: 25%; color: #000;">
                        <input type="checkbox" @(Model.ContratMaintenance ? "checked" : "") disabled style="margin-right: 5px;" />
                        <span style="color: #000;">Oui</span>
                        <input type="checkbox" @(!Model.ContratMaintenance ? "checked" : "") disabled style="margin-right: 5px; margin-left: 15px;" />
                        <span style="color: #000;">Non</span>
                    </td>
                </tr>
            </table>

            <!-- Tableau Equipements -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="background-color: #fff; color: #000;">Equipements</th>
                </tr>
                <tr>
                    <td style="color: #000;">
                        @if (!string.IsNullOrEmpty(Model.Detail?.Equipements))
                        {
                            if (Model.Detail.Equipements.Contains("<table"))
                            {
                                @Html.Raw(Model.Detail.Equipements)
                            }
                            else
                            {
                                var equipements = Model.Detail.Equipements.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                                if (equipements.Length > 1)
                                {
                                    <ul style="margin: 0; padding-left: 20px;">
                                        @foreach (var equipement in equipements)
                                        {
                                            if (!string.IsNullOrWhiteSpace(equipement))
                                            {
                                                <li style="margin-bottom: 5px;">@equipement.Trim()</li>
                                            }
                                        }
                                    </ul>
                                }
                                else
                                {
                                    @Model.Detail.Equipements
                                }
                            }
                        }
                    </td>
                </tr>
            </table>

            <!-- Tableau Accessoires -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="background-color: #fff; color: #000;">Accessoires</th>
                </tr>
                <tr>
                    <td style="color: #000;">
                        @if (!string.IsNullOrEmpty(Model.Detail?.Accessoires))
                        {
                            var accessoires = Model.Detail.Accessoires.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                            if (accessoires.Length > 1)
                            {
                                <ul style="margin: 0; padding-left: 20px;">
                                    @foreach (var accessoire in accessoires)
                                    {
                                        if (!string.IsNullOrWhiteSpace(accessoire))
                                        {
                                            <li style="margin-bottom: 5px;">@accessoire.Trim()</li>
                                        }
                                    }
                                </ul>
                            }
                            else
                            {
                                @Model.Detail.Accessoires
                            }
                        }
                    </td>
                </tr>
            </table>

            <!-- Tableau Travaux à la charge de Promamec -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="background-color: #fff; color: #000;">Travaux à la charge de Promamec</th>
                </tr>
                <tr>
                    <td style="color: #000;">@Model.Detail?.TravauxPromamec</td>
                </tr>
            </table>

            <!-- Tableau Commentaires -->
            <table class="table table-bordered" style="width: 100%; margin-bottom: 20px;">
                <tr>
                    <th style="background-color: #fff; color: #000;">Commentaire(s)</th>
                </tr>
                <tr>
                    <td style="color: #000;">@Model.Detail?.Commentaires</td>
                </tr>
            </table>
        </div>
        <a asp-action="Index" class="btn btn-secondary print-footer-hide" style="margin-top:2rem;">Retour à la liste</a>
        <button class="btn btn-primary print-footer-hide" style="margin-top:2rem;" onclick="window.print()">Imprimer la fiche projet</button>
    </div>
    <div class="print-footer" style="display:none;">
        Date d'impression : @DateTime.Now.ToString("dd/MM/yyyy HH:mm")
    </div>
</div>

<!-- Vue spéciale impression -->
<div class="print-table-view" style="background-color: #fff; color: #000;">
    <!-- En-tête avec logo et titre -->
    <div class="fiche-header" style="display: flex; align-items: center; margin-bottom: 20px;">
        <img src="~/img/promamec-logo.png" alt="PROMAMEC" style="width: 80px; height: auto; margin-right: 20px;" />
        <div class="fiche-title" style="text-align: center; flex-grow: 1; font-size: 2rem; font-weight: bold;">FICHE PROJET</div>
    </div>
    <hr class="fiche-divider" style="border: 2px solid #000; margin-bottom: 30px;" />
    
    <!-- Tableau Date (1 ligne, 2 colonnes) -->
    <table style="width: 50%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 30%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Date</th>
            <td style="width: 70%; border: 1px solid #000; padding: 7px 12px;">@DateTime.Now.ToString("dd/MM/yyyy")</td>
        </tr>
    </table>

    <!-- Tableau N° Projet et N° Affaires (2 lignes, 4 colonnes) -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">N° Projet / N° Marché</th>
            <td style="width: 25%; border: 1px solid #000; padding: 7px 12px;">@Model.NumeroProjet</td>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">N° Affaire(s)</th>
            <td style="width: 25%; border: 1px solid #000; padding: 7px 12px;">@Model.NumeroAffaire</td>
        </tr>
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Nom du Client/ Etablissement</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@Model.NomClient</td>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Nom & Téléphone du Contact</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@Model.TelephoneContact</td>
        </tr>
    </table>

    <!-- Tableau Contrat N° (1 ligne) -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Contrat N° / Bande de Commande</th>
            <td style="width: 75%; border: 1px solid #000; padding: 7px 12px;">@Model.ContratNumero</td>
        </tr>
    </table>

    <!-- Tableau autres champs (5 lignes, 2 colonnes) -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Adresse de livraison</th>
            <td style="width: 75%; border: 1px solid #000; padding: 7px 12px;">@Model.AdresseLivraison</td>
        </tr>
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Modalités de paiement Client</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@Model.ModalitePaiement</td>
        </tr>
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Dernier délai Livraison</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@(Model.DernierDelaiLivraison?.ToString("dd/MM/yyyy") ?? "")</td>
        </tr>
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Dernier délai d'exécution</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@(Model.DernierDelaiExecution?.ToString("dd/MM/yyyy") ?? "")</td>
        </tr>
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Durée de garantie</th>
            <td style="border: 1px solid #000; padding: 7px 12px;">@Model.DureeGarantie</td>
        </tr>
    </table>

    <!-- Tableau Détail Formation -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Détail Formation</th>
            <td style="width: 75%; border: 1px solid #000; padding: 7px 12px;">@Model.DetailFormation</td>
        </tr>
    </table>

    <!-- Tableau Dossier AMSSNUR et Contrat Maintenance -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Dossier AMSSNUR requis</th>
            <td style="width: 25%; border: 1px solid #000; padding: 7px 12px;">
                <input type="checkbox" @(Model.DossierAMSSNUR ? "checked" : "") disabled style="margin-right: 5px;" />
                <span style="color: #000;">Oui</span>
                <input type="checkbox" @(!Model.DossierAMSSNUR ? "checked" : "") disabled style="margin-right: 5px; margin-left: 15px;" />
                <span style="color: #000;">Non</span>
            </td>
            <th style="width: 25%; background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Contrat de maintenance à l'acquisition</th>
            <td style="width: 25%; border: 1px solid #000; padding: 7px 12px;">
                <input type="checkbox" @(Model.ContratMaintenance ? "checked" : "") disabled style="margin-right: 5px;" />
                <span style="color: #000;">Oui</span>
                <input type="checkbox" @(!Model.ContratMaintenance ? "checked" : "") disabled style="margin-right: 5px; margin-left: 15px;" />
                <span style="color: #000;">Non</span>
            </td>
        </tr>
    </table>

    <!-- Tableau Equipements -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Equipements</th>
        </tr>
        <tr>
            <td style="border: 1px solid #000; padding: 7px 12px; height: 2.2cm;">
                @if (!string.IsNullOrEmpty(Model.Detail?.Equipements))
                {
                    if (Model.Detail.Equipements.Contains("<table"))
                    {
                        @Html.Raw(Model.Detail.Equipements)
                    }
                    else
                    {
                        var equipements = Model.Detail.Equipements.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                        if (equipements.Length > 1)
                        {
                            <ul style="margin: 0; padding-left: 20px;">
                                @foreach (var equipement in equipements)
                                {
                                    if (!string.IsNullOrWhiteSpace(equipement))
                                    {
                                        <li style="margin-bottom: 5px;">@equipement.Trim()</li>
                                    }
                                }
                            </ul>
                        }
                        else
                        {
                            @Model.Detail.Equipements
                        }
                    }
                }
            </td>
        </tr>
    </table>

    <!-- Tableau Accessoires -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Accessoires</th>
        </tr>
        <tr>
            <td style="border: 1px solid #000; padding: 7px 12px; height: 2.2cm;">
                @if (!string.IsNullOrEmpty(Model.Detail?.Accessoires))
                {
                    var accessoires = Model.Detail.Accessoires.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    if (accessoires.Length > 1)
                    {
                        <ul style="margin: 0; padding-left: 20px;">
                            @foreach (var accessoire in accessoires)
                            {
                                if (!string.IsNullOrWhiteSpace(accessoire))
                                {
                                    <li style="margin-bottom: 5px;">@accessoire.Trim()</li>
                                }
                            }
                        </ul>
                    }
                    else
                    {
                        @Model.Detail.Accessoires
                    }
                }
            </td>
        </tr>
    </table>

    <!-- Tableau Travaux à la charge de Promamec -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Travaux à la charge de Promamec</th>
        </tr>
        <tr>
            <td style="border: 1px solid #000; padding: 7px 12px; height: 2.2cm;">@Model.Detail?.TravauxPromamec</td>
        </tr>
    </table>

    <!-- Tableau Commentaires -->
    <table style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
        <tr>
            <th style="background-color: #fff; color: #000; border: 1px solid #000; padding: 7px 12px;">Commentaire(s)</th>
        </tr>
        <tr>
            <td style="border: 1px solid #000; padding: 7px 12px; height: 2.2cm;">@Model.Detail?.Commentaires</td>
        </tr>
    </table>

    <div class="footer-date">Date d'impression : @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</div>
</div> 
@* Métadonnées masquées - visible uniquement en base de données *@
@if (Model.FicheModifications != null && Model.FicheModifications.Count > 0)
{
    <h3>Modifications</h3>
    <table border="1" style="width:100%;margin-bottom:1rem;">
        <tr>
            <th>Champ modifié</th>
            <th>Ancienne valeur</th>
            <th>Nouvelle valeur</th>
            <th>Date de modification</th>
        </tr>
        @foreach(var modif in Model.FicheModifications)
        {
            <tr>
                <td>@modif.ChampsModifie</td>
                <td>@modif.AncienneValeur</td>
                <td>@modif.NouvelleValeur</td>
                <td>@modif.DateModification.ToString("dd/MM/yyyy HH:mm")</td>
            </tr>
        }
    </table>
} 